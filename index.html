<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">

  <title>Be a lazy front-end developer with kick-ass page performance - SebCorbin</title>

  <link rel="shortcut icon" href="lib/image/favicon.ico"/>
  <meta name="description" content="Presentation description">
  <meta name="author" content="Speaker Name">

  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

  <link rel="stylesheet" href="css/reveal.css">
  <link rel="stylesheet" href="css/theme/black.css">
  <link rel="stylesheet" href="css/theme/ddd.css" id="theme">

  <!-- Code syntax highlighting -->
  <link rel="stylesheet" href="lib/css/zenburn.css">

  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement('link');
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
    document.getElementsByTagName('head')[0].appendChild(link);
  </script>

  <!--[if lt IE 9]>
  <script src="lib/js/html5shiv.js"></script>
  <![endif]-->
</head>

<body>

<div class="reveal">
  <footer>
    <div class="branding--logo">
      <span class="logo__image"><img src="lib/image/logo.png" alt="DrupalDeveloperDays Montpellier 2015 logo" height="55px"></span>

      <p class="logo__site-name">#drupaldevdays</p>
    </div>
    <div class="session--info">
      <p class="session__title">
        Be a lazy front-end developer<br/>
        with kick-ass page performance<span class="seperator">&nbsp;/&nbsp;</span>
      </p>

      <p class="session__presenter">@SebCorbin</p>
    </div>
  </footer>
  <!-- Any section element inside of this container is displayed as a slide -->
  <div class="slides">
    <section class="ddd-intro" data-background="lib/image/background.jpg">
      <h1>Be a lazy front-end<br/>
        developer with kick-ass<br/>
        page performance</h1>

      <h2>Sébastien Corbin - @SebCorbin</h2>
    </section>

    <section>
      <h2>Who am I?</h2>

      <p>Sébastien Corbin - @SebCorbin</p>
      <img src="http://makinacorpus.github.io/makina-slides/theme_extra/logo.png" width="298" height="212" class="no-style"/>
      <img src="http://montpellier2015.drupaldays.org/sites/default/files/sponsor-3-healthyfood.png" width="250" height="250" class="no-style"/>
      <p style="font-size: .8em">Taking care of your diet / Drupal issues<br/>
        <em>Slides online at <a href="http://bit.ly/ddd_banana">bit.ly/ddd_banana</a></em>
      </p>
    </section>

    <section data-background="#C21426" data-background-transition="convex">
      <h2>Question yourself</h2>

      <p>
        How many clicks per day?
      </p>

      <p>
        How many characters typed per day?
      </p>

      <p>
        <img src="http://i.giphy.com/bAplZhiLAsNnG.gif" width="500" height="300"/><br/>
        I'm here for your carpal tunnel syndrome !
      </p>
    </section>
    <section>
      <h2>Basic integration workflow</h2>
      <img src="lib/image/basic_workflow.png" width="936" height="425" class="no-style"/>
    </section>

    <!-- Example of nested vertical slides -->
    <section>
      <h2>Real integration workflow</h2>

      <div style="position: relative">
        <img src="lib/image/advanced_workflow.png" width="996" height="508" class="no-style"/>
        <img src="lib/image/alt-tab.png" class="no-style fragment" style="position: absolute;top: 17%;left: 13%"/>
        <img src="lib/image/alt-tab.png" class="no-style fragment" style="position: absolute;top: 72%;left: 10%"/>
        <img src="lib/image/alt-tab.png" class="no-style fragment" style="position: absolute;top: 10px;left: 30%"/>

        <div class="fragment">
          <img src="lib/image/alt-tab.png" class="no-style" style="position: absolute;top: 20px;left: 60%"/>
          <img src="lib/image/alt-tab.png" class="no-style" style="position: absolute;top: 80%;left: 30%"/>
          <img src="lib/image/alt-tab.png" class="no-style" style="position: absolute;top: 75%;left: 60%"/>
        </div>
      </div>
    </section>
    <section data-background="#C21426" data-background-transition="convex">
      <h2>Script everything!</h2>

      <p>
        <img src="http://i.imgur.com/gKNJcmV.jpg" width="500" height="416"/>
      </p>
    </section>


    <section>
      <h2>Photoshop</h2>

      <p>
        <img src="lib/image/photoshop.gif" width="800" height="430" class="no-style"/>
      </p>
    </section>

    <section>
      <h2>Illustrator</h2>

      <p>
        <span>More advanced, JavaScript API (<a href="https://s3.amazonaws.com/media-p.slid.es/uploads/sebcorbin/images/1244379/illustrator.gif">gist</a>)</span>
        <img src="lib/image/illustrator.gif" width="800" height="500" class="no-style"/>
      </p>
    </section>

    <section data-background="#C21426" data-background-transition="convex">
      <h2>Not ... Fast ... enough!</h2>

      <p>
        <img src="http://i.giphy.com/fQZX2aoRC1Tqw.gif" width="533" height="300"/>
      </p>
    </section>

    <section>
      <p style="font-style: italic">On the HTML/CSS/JS side: use web frameworks</p>

      <h2>Bootstrap</h2>

      <p><strong>Advantages</strong></p>
      <ul>
        <li>active community (numerous snippets)</li>
        <li>mobile-friendly</li>
        <li>possibility to overwrite everything</li>
      </ul>

      <p><strong>Drawbacks</strong></p>
      <ul>
        <li>CSS Overhead (<code>border-radius: 0px</code>)</li>
        <li>"Everything looks the same"</li>
      </ul>
    </section>

    <section>
      <img src="http://vincekotchian.com/wp-content/uploads/2014/05/Wrong.jpg" width="250" height="250" style="float: left; margin-right: 1em"/>

      <p style="text-align: left">
        See the
        <a href="http://expo.getbootstrap.com/">Bootstrap showcase</a><br/>
        <strong>Tips:</strong></p>
      <ul style="display: block">
        <li>Take time to read all of variables.less</li>
        <li>Think before overwriting any selector</li>
        <li>Comment any .less include that is not used</li>
        <li>Use LESS/SASS functions/mixins all you can:
          <ul>
            <li><code>:before</code> and <code>:after</code> for icons</li>
            <li>everything with a parameter</li>
          </ul>
        </li>
      </ul>
    </section>

    <section data-background="#C21426" data-background-transition="convex">
      <p>
        Is it worth the time?<br/>
        <img src="https://imgs.xkcd.com/comics/is_it_worth_the_time.png" width="571" height="464"><br/>
        (most of the time: yes)
      </p>
    </section>

    <section>
      <h2>Some performance knowledge</h2>
      <img src="lib/image/waterfall.png" width="720" height="326.5" />
    </section>

    <section style="text-align: left">
      <h3>DomContentLoaded event</h3>
      <p>Fired when the document has been completely loaded and parsed, without waiting for stylesheets, images, and subframes to finish loading</p>
      <h3>Load event</h3>
      <p>Fired when a resource and its dependent resources have finished loading</p>
    </section>

    <section style="text-align: left">
      <h3>FOUC</h3>
      <p>Flash of Unstyled Content, moment during a web page appears briefly with the browser's default styles prior to loading an external CSS stylesheet. This shift is quite visible and distracting</p>
      <h3>RTT/RTD</h3>
      <p>Round-trip time, length of time it takes for a request to be sent and received, huge dependency on TCP and environemental factors (espacially for mobiles)</p>
    </section>

    <section style="text-align: left">
      <h3>Reminder</h3>
      <ul>
        <li>The less requests, the better</li>
        <li>Watch out for the size, it may be better to split & parallelize</li>
        <li>Think about you ressource ordering</li>
        <li>Avoid external resources, <code>defer</code> all of them</li>
        <li>Equip yourself with Varnish and/or CDN (with CDN prefetch)</li>
      </ul>
    </section>

    <section data-background="#C21426" data-background-transition="convex">
      <p>Ok, let's fast forward...</p>
      <img src="http://i.giphy.com/W0rn83tb8a1yM.gif" width="500" height="279"/>
    </section>

    <section>
      <img src="http://www.codingpedia.org/wp-content/uploads/2014/04/gulp-2x.png" width="240" height="240" style="float: left" class="no-style">

      <h2>Gulp</h2>

      <p>All-purpose task automator</p>
      <ul>
        <li>NodeJS-based</li>
        <li>Alternatives: Grunt, Brunch</li>
        <li>Stream-based (less I/O than Grunt)</li>
        <li>Less plugins than Grunt</li>
      </ul>
    </section>

    <section>
      <h2>What kind of tasks?</h2>

      <ul>
        <li>Convert LESS/SASS to CSS</li>
        <li>Minify/Obfuscate CSS/JS</li>
        <li>Check JS/SASS syntax</li>
        <li>Create sprites/icon fonts</li>
        <li>Test CSS regressions</li>
        <li>Run JS tests</li>
        <li>Analyse/Tackle performance tasks</li>
        <li>Reload browser on change</li>
        <li>Add/Commit/Push files to Git repo</li>
        <li>Upload files to FTP</li>
      </ul>
    </section>

    <section>
      <span>Gulp installation</span>
      <pre><code># Prerequisisite, install NodeJS
npm install --global gulp</code></pre>

      <span>Plugin installation</span>
      <pre><code>npm install --save-dev gulp-cssmin # Writes version to package.json</code></pre>

      <span>Task definition</span>
      <pre><code>var gulp = require('gulp');
var cssmin = require('gulp-cssmin');

gulp.task('default', function () {
  gulp.src('src/**/*.css')
      .pipe(cssmin())
      .pipe(rename({suffix: '.min'}))
      .pipe(gulp.dest('dist'));
});</code></pre>

      <p>Then launch <code>gulp</code> in your terminal</p>
    </section>

    <section>
      <h2>Plugins</h2>

      <ul style="font-size: .9em">
        <li>Bundled : <em>watch</em>, run task everytime a file is changed</li>
        <li class="fragment" data-fragment-index="0">
          <a href="http://gulpjs.com/plugins/" target="_blank">1482 plugins</a> as of today
        </li>
        <li class="fragment" data-fragment-index="1">Some useful examples:
          <ul>
            <li>
              <em>autoprefixer</em>: prefix automatically CSS3 vendor-specific properties
            </li>
            <li>
              <em>livereload</em>: reload automatically a browser page when a task ends
            </li>
            <li>
              <em>criticalcss</em>: compute required above-the-fold CSS for inlining
            </li>
            <li>
              <em>sourcemaps</em>: map uncompiled CSS/JS referenced in HTML element
            </li>
            <li>
              <em>base64</em>: convert and inline small images to base64
            </li>
          </ul>
        </li>
      </ul>
    </section>

    <section style="top: 0">
					<pre style="margin: -50px 0 0;width: 100%"><code style="max-height: 650px">var gulp = require('gulp');
var uglify = require('gulp-uglify');
var jshint = require('gulp-jshint');
var less = require('gulp-less');
var cssmin = require('gulp-minify-css');
var concat = require('gulp-concat');
var gzip = require('gulp-gzip');
var imagemin = require('gulp-imagemin');
var rename = require('gulp-rename');
var sourcemaps = require('gulp-sourcemaps');
var pngquant = require('imagemin-pngquant');
var iconfont = require('gulp-iconfont');
var spritesmith = require('gulp.spritesmith');

var use_sourcemaps = true;

// Concat and minify JS, reading map.json
gulp.task('js', function () {
  var map = require('./js/map.json'), list = [];
  for (var i in map) {
    if (map.hasOwnProperty(i) && map[i]) {
      // Make relative to drupal path
      list.push('../../../../' + i);
    }
  }
  var pipe = gulp.src(list);
  if (use_sourcemaps) {
    pipe = pipe.pipe(sourcemaps.init());
  }
  pipe = pipe.pipe(concat('script.min.js'))
      .pipe(uglify());
  if (use_sourcemaps) {
    pipe = pipe.pipe(sourcemaps.write('./maps'));
  }
  return pipe.pipe(gulp.dest('./dist/'))
      .pipe(gzip())
      .pipe(gulp.dest('./dist/')).on('error', errorHandler);
});


// LESS compilation
gulp.task('less', function () {
  var pipe = gulp.src('./less/style.less');
  if (use_sourcemaps) {
    pipe = pipe.pipe(sourcemaps.init());
  }
  pipe = pipe
      .pipe(less()).on('error', errorHandler)
      .pipe(cssmin()).on('error', errorHandler)
      .pipe(rename({suffix: '.min'})).on('error', errorHandler);
  if (use_sourcemaps) {
    pipe = pipe.pipe(sourcemaps.write('./maps'));
  }
  return pipe
      .pipe(gulp.dest('./dist/')).on('error', errorHandler)
      .pipe(gzip()).on('error', errorHandler)
      .pipe(gulp.dest('./dist/')).on('error', errorHandler);
});

// Image optimisation
gulp.task('images', function () {
  return gulp.src(['./img*/*', './dist*/sprite.png'])
      .pipe(imagemin({
        progressive: true,
        use: [pngquant()]
      })).on('error', errorHandler)
      .pipe(gulp.dest('.')).on('error', errorHandler);
});

// Icons
gulp.task('icons', function () {
  return gulp.src('svg/*')
      .pipe(iconfont({
        fontName: 'iconsfont',
        appendCodepoints: true,
        normalize: true
      }))
      .pipe(gulp.dest('./dist/'))
});

// Sprites
gulp.task('sprite', function () {
  var spriteData =
      gulp.src('img/sprite/*.*') // source path of the sprite images
          .pipe(spritesmith({
            imgName: 'sprite.png?' + (new Date).getTime(),
            cssName: 'sprite.less',
            algorithm: 'binary-tree'
          }));

// output path for the sprite
  spriteData.img.pipe(rename('sprite.png')).pipe(gulp.dest('./dist/'));
// output path for the CSS
  spriteData.css.pipe(gulp.dest('./less/'));
});

gulp.task('default', ['jshint', 'js', 'sprite', 'images', 'less', 'icons']);

gulp.task('watch', function () {
  gulp.watch(['./js/*', '../../modules/**/*.js'], ['js', 'jshint']);
  gulp.watch('./less/*.less', ['less']);
  gulp.watch('./img/*', ['images', 'sprite', 'less']);
  gulp.watch('./svg/*', ['icons']);
});

// Handle the errors
function errorHandler(error) {
  console.log(error.toString());
  this.emit('end');
}</code></pre>
    </section>

    <section>
      <h3>Quite a big file huh?</h3>
      <p>Let's automate that with Drupal</p>

      <p>&nbsp;</p>
      <p>Meet <a href="https://github.com/makinacorpus/drupal-gulpifier">gulpifier</a>, a module that helps you set up your gulpfile</p>
    </section>

    <section>
      <h2>Drupal flows</h2>
      <dl>
        <dt>Too many assets requests</dt>
        <dd>3 or 4 CSS/JS bundles per page, can be reduced with advagg</dd>
        <dt>Poor minification</dt>
        <dd>CSS: only comments and whitespace removed, JS: aggregation only</dd>
        <dt>Every module adds its own assets</dt>
        <dd>Not everyone knows about <code>#attached</code> property</dd>
      </dl>
    </section>

    <section>
      <h2>Propositions</h2>
      <dl>
        <dt>Too many assets requests</dt>
        <dd>Keep a single CSS and JS file, most of the time, allow a whitelist for the rest</dd>
        <dt>Poor minification</dt>
        <dd>Use heavily used gulp plugins, providing production-ready files</dd>
        <dt>Every module adds its own assets</dt>
        <dd>Better to start from scratch, blacklist everything else</dd>
      </dl>
    </section>

<!--
    <section data-background="#C21426" data-background-transition="convex">
      <p>Hmmm, still too many Alt+Tab...</p>
      <img src="http://i.giphy.com/W0rn83tb8a1yM.gif" width="500" height="279"/>

      <p>What if we could code directly in the browser<br/> and see our changes live?!?
      </p>
    </section>

    <section>
      <h3>Meet the powerful Chrome DevTools</h3>

      <p>
        <img src="lib/image/sourcemaps.png" width="313" height="75" style="float: left"/>
        Sourcemaps links take you directly to the source code at the right selector
      </p>
      <p style="text-align: left">
        <img src="lib/image/settings.png" width="399" height="324" style="float: left;margin-right: 1em"/>
        Provided features:
      </p>
      <ul>
        <li>Syntax highlighting</li>
        <li>Shortcuts</li>
        <li>Basic autocomplete</li>
        <li>Simple search and navigation</li>
        <li>Link to local files</li>
        <li>Reloading of CSS files</li>
      </ul>
    </section>
-->
    <section data-background="#C21426" data-background-transition="convex">
      <h2>Demo</h2>
      <img src="http://i.giphy.com/CzbiCJTYOzHTW.gif" width="500" height="281"/>
      <p style="font-style: italic">♬ ... elevator music ... ♪</p>
    </section>

    <section data-background="#C21426" data-background-transition="convex">
      <h2>Questions?</h2>
      <img src="http://www.reactiongifs.com/r/2013/10/tim-and-eric-mind-blown.gif" width="315" height="210"/>
    </section>

    <section data-background="#C21426" data-background-transition="convex">
      <h2>Thank you</h2>
      <img src="" width="315" height="210"/>
    </section>

  </div>

</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>

  // Full list of configuration options available at:
  // https://github.com/hakimel/reveal.js#configuration
  Reveal.initialize({
    controls: true,
    progress: true,
    history: true,
    center: true,

    transition: 'slide', // none/fade/slide/convex/concave/zoom

    // Optional reveal.js plugins
    dependencies: [
      {
        src: 'lib/js/classList.js', condition: function () {
        return !document.body.classList;
      }
      },
      {
        src: 'plugin/markdown/marked.js', condition: function () {
        return !!document.querySelector('[data-markdown]');
      }
      },
      {
        src: 'plugin/markdown/markdown.js', condition: function () {
        return !!document.querySelector('[data-markdown]');
      }
      },
      {
        src: 'plugin/highlight/highlight.js',
        async: true,
        condition: function () {
          return !!document.querySelector('pre code');
        },
        callback: function () {
          hljs.initHighlightingOnLoad();
        }
      },
      {src: 'plugin/zoom-js/zoom.js', async: true},
      {src: 'plugin/notes/notes.js', async: true}
    ]
  });

</script>

</body>
</html>
